<!DOCTYPE html>
<html>
    <head>
        <title>Leauge Chat</title>
        <link type="text/css" rel="stylesheet" href="{{STATIC_URL}}style.css" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
        <script src="{{STATIC_URL}}socket.io.js"></script> <!-- http://ec2-54-86-25-186.compute-1.amazonaws.com:4000 -->
        
        <script>
        	
        	var users = [];
        	var ding = new Audio("{{STATIC_URL}}noti.mp3");
        	$(document).ready(function(){
        		
        		
        		var socket = io.connect('ec2-54-86-25-186.compute-1.amazonaws.com',{port: 80,'sync disconnect on unload':true});
        		var box = document.getElementById('box');
        		var ndata = "";
        		socket.on('connect', function(){
        			socket.emit('set nickname', '{{prof.ign}}');
        			
        			box.scrollTop = box.scrollHeight;
        			console.log("connect");
        			
        		});
        		
        		
        		
        		socket.on('new user connected',function(name){
        			$('#comments').append('<br />'+name+' has connected to the chat!!');
        			box.scrollTop = box.scrollHeight;
        		});
        		var entry_el = $('#comment');
        		
        		box.scrollTop = box.scrollHeight;
        		
        		socket.on('message', function(message){
        			//escape html chars
        			var data = message.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
        			
        			
        			
        			
        			//append message to the bottom of the list
        			//   root: msg:May 2, 2014, 6:02 PM
        			ndata = data.split(":");
        			//root
        			//msg
        			//May2, 2014, 6
        			//02 PM
        			var cdata = ndata.splice(1,ndata.length-3);
        			var date = ndata.splice(ndata.length-2,ndata.length);
        			console.log(date);
        			cdata = cdata.join(":");
        			var date = date.join(":");
        			
        			
        			if(cdata.match("PJSalt")){
        				console.log('pissin me off');
        				$('#comments').append('<br /><img src="http://i.imgur.com/Milbonj.png" height="20" width="20"><a href="/user/'+ndata[0]+'/">'+ndata[0]+'</a>:' +'<img src="http://www.ilest4h.fr/files/faces/PJSalt.png"><small>'+date+'</small>' );
        			}else{
        				$('#comments').append('<br /><img src="http://i.imgur.com/Milbonj.png" height="20" width="20"><a href="/user/'+ndata[0]+'/">'+ndata[0]+'</a>:' +cdata + '<small>'+date+'</small>' );
        			}
        			
        			//window.scrollBy(0, 10000000000);
        			ding.play();
  					box.scrollTop = box.scrollHeight;
        			entry_el.focus();
        		});
        		
        		
        		
        		entry_el.keypress(function(event){
        			//when enter is pressed send input value to node server
        			if(event.keyCode !=13) return;
        			var msg = entry_el.attr('value');
        			
        			if(msg){
        				socket.emit('send_message', msg, function(data){
        					console.log(data);
        				});
        				
        				//clear input value
        				entry_el.attr('value', '');
        			}
        		});
        		
        		
        		socket.on('new user', function(users){
        			
        			$("#users").empty();
        			$('#users').append('Users:');
        			for(var user in users){
        				//console.log(user+' joined');
        				
        				$('#users').append('<br /><a href="/user/'+user+'/">'+user+'</a> ');
        			}
        		});
        		
        		socket.on('user disconnected mother fucker', function(dude){
        			$('#comments').append('<br />'+dude+' disconnected! ...that loser.');
        			console.log(dude+' disconnected');
        		});
        		var kickButton = document.getElementById("kick");
        		if(kickButton != null){
        			kickButton.onclick = function () { 
	        			var dudek = $("#kickbox").val();
	        			socket.emit('kick', dudek);
	        		};
	        	};
        		socket.on('kicked', function(){
        			socket.disconnect()
        			alert("You've been kicked!!!");
        			window.location = "/logout/";
        		});
        		socket.on('banned', function(ip){
        			//socket.disconnect();
        			//alert("You're banned! "+ip);
        			//window.location = "/";
        		})
        		//# END SOCKETS
        		
        		
        		
        		
        		
        		window.addEventListener('beforeunload',function(event){
        			socket.disconnect();
        		});
        		
        	});
        </script>
	<!--                 STYLE       -->
	<style type="text/css">
    	
    	body{
			background-image: url('{{STATIC_URL}}bg.png');
			background-size: cover;
		}
    	
    	
    	
    	
    	small{
    		color:#aaaaaa;
    		font-size:xx-small;
    		float:right;
    	}
    	.content{
    		padding:90px 0px 19% 19%;
    	}
    	#box {
    		float:left; overflow:auto; height:410px; width:60%; padding:0px 0px 0px 0px;box-shadow:inset 0px 5px 10px 0px #888;background-color:white;
    		word-wrap:break-word;
    		position:justify;
    		
    	}
    	#comment{
    		float:left;position:relative;bottom:0; width:95%;box-shadow:inset 0px 1px 2px 0px #888;
    	}
	</style>



<!--                     END STYLE          -->
    </head>

    <body>
    {% block content %}{% endblock %}
    </body>
</html>
